<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFPRC AR - Final Polish</title>
    
    <style>
        #overlay, #loadingOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; font-family: sans-serif; text-align: center;
        }
        #overlay { background: rgba(0,0,0,0.95); z-index: 9999; }
        #loadingOverlay { background: #002b5b; z-index: 9998; display: none; }
        
        #startBtn {
            padding: 20px 40px; font-size: 20px; border-radius: 50px; 
            border: none; background: #002b5b; color: white; cursor: pointer; font-weight: bold;
        }

        /* THE CENTERED PLAY BUTTON: Fast & Reliable */
        #htmlPlayOverlay {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80px; height: 80px; background: rgba(255, 255, 255, 0.8);
            border-radius: 50%; display: none; 
            justify-content: center; align-items: center; z-index: 1000; cursor: pointer;
        }
        #htmlPlayOverlay::after {
            content: ''; display: block; border-style: solid;
            border-width: 15px 0 15px 25px; border-color: transparent transparent transparent #002b5b;
            margin-left: 5px;
        }

        .spinner {
            width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%; border-top-color: #fff;
            animation: spin 1s ease-in-out infinite; margin-bottom: 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>

<body>
    <div id="overlay">
        <h2>NFPRC AR Experience</h2>
        <button id="startBtn">TAP TO ENTER AR</button>
    </div>

    <div id="loadingOverlay"><div class="spinner"></div><p>Initializing...</p></div>

    <div id="htmlPlayOverlay"></div>

    <a-scene mindar-image="imageTargetSrc: ./targets.mind; autoStart: false;" 
             vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        
        <a-assets>
            <video id="vid" src="./your-video.mp4" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline muted></video>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false">
            <a-cursor raycaster="objects: .clickable" cursor="fuse: false; rayOrigin: mouse;"></a-cursor>
        </a-camera>

        <a-entity id="ar-target" mindar-image-target="targetIndex: 0">
            <a-video id="videoPlane" src="#vid" class="clickable" 
                     position="-0.01 -0.32 0.01" width="0.9" height="0.5">
            </a-video>

            <a-entity id="buttonGroup" position="0.55 -0.32 0.02" visible="false">
                <a-plane class="clickable" color="#002b5b" width="0.18" height="0.1" position="0 0.12 0" 
                         text="value: INFO; align: center; color: #FFF; width: 0.8"
                         onclick="window.open('https://nationfirstlr.substack.com', '_blank')"></a-plane>
                <a-plane class="clickable" color="#002b5b" width="0.18" height="0.1" position="0 0 0" 
                         text="value: X; align: center; color: #FFF; width: 0.8"
                         onclick="window.open('https://x.com/nfprc_ind', '_blank')"></a-plane>
                <a-plane class="clickable" color="#002b5b" width="0.18" height="0.1" position="0 -0.12 0" 
                         text="value: EMAIL; align: center; color: #FFF; width: 0.8"
                         onclick="window.location.href='mailto:workshops@nationfirstpolicy.org'"></a-plane>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        const startBtn = document.querySelector('#startBtn'), overlay = document.querySelector('#overlay');
        const loadingOverlay = document.querySelector('#loadingOverlay'), playOverlay = document.querySelector('#htmlPlayOverlay');
        const sceneEl = document.querySelector('a-scene'), targetEl = document.querySelector("#ar-target");
        const video = document.querySelector("#vid"), videoPlane = document.querySelector("#videoPlane");
        const buttonGroup = document.querySelector("#buttonGroup");

        // The logic that worked before: Direct Video Control
        const toggleVideo = () => {
            if (video.paused) {
                video.muted = false; // Unmute on interaction
                video.play();
                playOverlay.style.display = 'none';
            } else {
                video.pause();
                playOverlay.style.display = 'flex';
            }
        };

        startBtn.addEventListener('click', () => {
            overlay.style.display = 'none';
            loadingOverlay.style.display = 'flex';
            video.load(); // Start buffering
            sceneEl.systems['mindar-image-system'].start();
        });

        sceneEl.addEventListener("arReady", () => { loadingOverlay.style.display = 'none'; });

        // Tapping the video or the play button works
        playOverlay.addEventListener('click', toggleVideo);
        videoPlane.addEventListener('click', toggleVideo);
        
        targetEl.addEventListener("targetFound", () => { if (video.paused) playOverlay.style.display = 'flex'; });
        targetEl.addEventListener("targetLost", () => { 
            playOverlay.style.display = 'none'; video.pause(); buttonGroup.setAttribute("visible", false); 
        });

        // Swipe Logic
        let touchstartX = 0, touchendX = 0;
        document.addEventListener('touchstart', e => touchstartX = e.changedTouches[0].screenX );
        document.addEventListener('touchend', e => { 
            touchendX = e.changedTouches[0].screenX;
            if (touchendX - touchstartX > 50) buttonGroup.setAttribute("visible", true);  
            if (touchstartX - touchendX > 50) buttonGroup.setAttribute("visible", false); 
        });
    </script>
</body>
</html>