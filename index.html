<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFPRC AR - Final Top-Down</title>
    
    <style>
        #overlay, #loadingOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; font-family: sans-serif; text-align: center; z-index: 9999;
        }
        #overlay { background: rgba(0,0,0,0.95); }
        #loadingOverlay { background: #002b5b; display: none; }
        
        /* 2D FLOATING PLAY BUTTON */
        #floatingBtn {
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
            padding: 15px 40px; font-size: 18px; border-radius: 50px; 
            border: 2px solid white; background: #002b5b; color: white;
            font-weight: bold; cursor: pointer; display: none; z-index: 1000;
        }

        /* 2D TOP MENU (Triggered by Top-to-Bottom Swipe) */
        #topLinksMenu {
            position: fixed; top: -100px; /* Hidden above by default */
            left: 0; width: 100%; padding: 20px 0;
            background: rgba(0, 43, 91, 0.95); 
            display: flex; justify-content: space-around; align-items: center; 
            z-index: 1001; transition: top 0.3s ease-out; /* Smooth slide-down */
            border-bottom: 2px solid white;
        }
        .socialLink {
            color: white; text-decoration: none; font-weight: bold; 
            font-size: 14px; padding: 10px 15px; border: 1px solid white; border-radius: 5px;
        }

        #startBtn {
            padding: 20px 40px; font-size: 20px; border-radius: 50px; 
            border: none; background: #002b5b; color: white; cursor: pointer; font-weight: bold;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%; border-top-color: #fff;
            animation: spin 1s ease-in-out infinite; margin-bottom: 15px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>

<body>
    <div id="overlay">
        <h2>NFPRC AR Experience</h2>
        <button id="startBtn">TAP TO ENTER AR</button>
    </div>

    <div id="loadingOverlay"><div class="spinner"></div><p>Stabilizing View...</p></div>

    <div id="topLinksMenu">
        <a href="https://nationfirstlr.substack.com" target="_blank" class="socialLink">INFO</a>
        <a href="https://x.com/nfprc_ind" target="_blank" class="socialLink">X</a>
        <a href="mailto:workshops@nationfirstpolicy.org" class="socialLink">EMAIL</a>
    </div>

    <button id="floatingBtn">PLAY</button>

    <a-scene 
    mindar-image="imageTargetSrc: ./targets.mind; autoStart: false; filterMinCF:0.0001; filterBeta: 0.001;" 
    vr-mode-ui="enabled: false" 
    device-orientation-permission-ui="enabled: false">
        <a-assets>
            <video id="vid" src="./your-video.mp4" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline muted></video>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false">
            <a-cursor raycaster="objects: .clickable" cursor="fuse: false; rayOrigin: mouse;"></a-cursor>
        </a-camera>

        <a-entity id="ar-target" mindar-image-target="targetIndex: 0">
            <a-video id="videoPlane" src="#vid" class="clickable" 
                     position="-0.01 -0.32 0.01" width="0.9" height="0.5">
            </a-video>
        </a-entity>
    </a-scene>

    <script>
        const startBtn = document.querySelector('#startBtn'), floatingBtn = document.querySelector('#floatingBtn');
        const video = document.querySelector("#vid"), targetEl = document.querySelector("#ar-target");
        const topLinksMenu = document.querySelector('#topLinksMenu');

        const toggleVideo = () => {
            if (video.paused) {
                video.muted = false; 
                video.play();
                floatingBtn.innerText = "PAUSE";
            } else {
                video.pause();
                floatingBtn.innerText = "PLAY";
            }
        };

        startBtn.addEventListener('click', () => {
            document.querySelector('#overlay').style.display = 'none';
            document.querySelector('#loadingOverlay').style.display = 'flex';
            video.load(); 
            document.querySelector('a-scene').systems['mindar-image-system'].start();
        });

        document.querySelector('a-scene').addEventListener("arReady", () => { 
            document.querySelector('#loadingOverlay').style.display = 'none'; 
            floatingBtn.style.display = 'block';
        });

        floatingBtn.addEventListener('click', toggleVideo);
        document.querySelector("#videoPlane").addEventListener('click', toggleVideo);
        
        targetEl.addEventListener("targetFound", () => { 
            floatingBtn.style.display = 'block';
        });

        targetEl.addEventListener("targetLost", () => { 
            floatingBtn.style.display = 'none';
            topLinksMenu.style.top = '-100px'; // Hide menu on tracking loss
            video.pause(); 
        });

        // UPDATED: VERTICAL SWIPE LOGIC (Top-to-Bottom)
        let touchstartY = 0, touchendY = 0;
        document.addEventListener('touchstart', e => touchstartY = e.changedTouches[0].screenY );
        document.addEventListener('touchend', e => { 
            touchendY = e.changedTouches[0].screenY;
            
            // SWIPE DOWN (Top-to-Bottom) to Show
            if (touchendY - touchstartY > 70) topLinksMenu.style.top = '0px';  
            
            // SWIPE UP (Bottom-to-Top) to Hide
            if (touchstartY - touchendY > 70) topLinksMenu.style.top = '-100px'; 
        });
    </script>
</body>
</html>